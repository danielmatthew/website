---
import { CollectionEntry, getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import TableOfContents from "../../components/TableOfContents.astro";
import { number } from "astro/zod";
interface Props {
  entry: CollectionEntry<"work">;
}

export async function getStaticPaths() {
  const work = await getCollection("work", ({data}) => {
    return data.draft !== true;
  });

  const numberOfPosts = work.length;

  return work.map((entry, index) => ({
    params: { slug: entry.slug },
    props: {
      entry,
      prevPost:
        index + 1 === numberOfPosts
        ? { frontmatter: ''}
        : work[index + 1],
      nextPost:
        index === 0
        ? { frontmatter: ''}
        : work[index - 1],
    },
  }));
}

const { entry, prevPost, nextPost } = Astro.props;
const { Content, headings } = await entry.render();
---

<BaseLayout
  title={entry.data.title}
>
  <main class="wrapper">
    <article>
      <header>
        <div class="flow masthead">
          <h1>{entry.data.title}</h1>

          <div class="meta">
            <span class="org">Talis</span>
            <time datetime={entry.data.publishDate.toISOString()}>
              {entry.data.projectDate}
            </time>
          </div>
          {
            entry.data.tags && (
              <ul class="roles">
                {entry.data.tags.map((role) => (
                  <li>{role}</li>
                ))}
              </ul>
            )
          }
        </div>
      </header>
      <section class="layout">

        <div class="summary flow">
          <strong>TL; DR</strong>
          <p class="lede">
            {entry.data.description}
          </p>
        </div>

        <!-- <TableOfContents headings={headings} /> -->

        <div class="content flow">
          <Content />

        </div>
      </section>
    </article>
    <nav aria-label="Other work">
      {prevPost &&
        <a href={`/${prevPost.slug}/`}>
          {prevPost.data.title}
        </a>
      }
      {nextPost &&
        <a href={`/${nextPost.slug}/`}>
          {nextPost.data.title}
        </a>
      }
    </nav>
  </main>
</BaseLayout>
<style>

  nav {
    display: flex;
    margin-top: var(--space-xl);
    border-top: 1px solid var(--border);
    justify-content: space-between;
  }

  nav > a {
    display: block;
    margin: var(--space-xs);
    padding: var(--space-xs);
    flex: 1;
  }

  nav > a:hover,
  nav > a:focus {
    background-color: var(--text);
    text-decoration-color: var(--background);
    color: var(--background);
  }


  .roles {
    list-style-type: none;
    padding: 0;
    margin-block-end: 0;
  }

  .meta,
  .roles {
    display: flex;
    font-size: var(--step-0);
  }

  .meta {
    margin-block-start: var(--space-s);
  }

  .roles {
    font-size: var(--step--1);
    flex-wrap: wrap;
  }

  .meta > *:not(:last-child)::after {
    content: "Â·";
    padding-inline-start: var(--space-3xs);
    margin-inline-end: var(--space-3xs);
  }

  .meta > * + * {
    margin-top: 0;
  }

</style>
